# Test code for the MSO modules
# Copyright: (c) 2025, Akini Ross (@akinross) <akinross@cisco.com>

# GNU General Public License v3.0+ (see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt)

- name: Test that we have an ACI MultiSite host, username and password
  ansible.builtin.fail:
    msg: "Please define the following variables: mso_hostname, mso_username and mso_password."
  when: mso_hostname is not defined or mso_username is not defined or mso_password is not defined

- name: Set vars
  ansible.builtin.set_fact:
    mso_info: &mso_info
      host: "{{ mso_hostname }}"
      username: "{{ mso_username }}"
      password: "{{ mso_password }}"
      validate_certs: "{{ mso_validate_certs | default(false) }}"
      use_ssl: "{{ mso_use_ssl | default(true) }}"
      use_proxy: "{{ mso_use_proxy | default(true) }}"
      output_level: '{{ mso_output_level | default("debug") }}'

# QUERY VERSION
- name: Query MSO version
  cisco.mso.mso_version:
    <<: *mso_info
    state: query
  register: version

- name: Execute tasks only for NDO version >= 4.4
  when: version.current.version is version('4.4', '>=')
  block:
    
    # CLEAN ENVIRONMENT - ENSURE CLEAN ENVIRONMENT FOR TESTS

    - name: Ensure ansible_test tenant exist
      cisco.mso.mso_tenant:
        <<: *mso_info
        tenant: '{{ mso_tenant | default("ansible_test") }}'
        users:
          - '{{ mso_username }}'
        sites:
          - '{{ mso_site | default("ansible_test") }}'
        state: present

    - name: Ensure L3out template does not exist
      cisco.mso.ndo_template: &ndo_l3out_template_absent
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        template_type: l3out
        tenant: '{{ mso_tenant | default("ansible_test") }}'
        sites:
          - name: '{{ mso_site | default("ansible_test") }}'
        state: absent

    - name: Ensure ansible_test schema does not exist
      cisco.mso.mso_schema_template: &mso_schema_template_absent
        <<: *mso_info
        schema: '{{ mso_schema | default("ansible_test") }}'
        tenant: '{{ mso_tenant | default("ansible_test") }}'
        template: template_1
        state: absent

    - name: Ensure ansible_fabric_resource_template does not exist
      cisco.mso.ndo_template: &ndo_fabric_resource_template_absent
        <<: *mso_info
        name: '{{ mso_fabric_resource_template | default("ansible_test") }}'
        template_type: fabric_resource
        sites:
          - name: '{{ mso_site | default("ansible_test") }}'
        state: absent

    - name: Ensure ansible_fabric_policy_template does not exist
      cisco.mso.ndo_template: &ndo_fabric_policy_template_absent
        <<: *mso_info
        name: '{{ mso_fabric_policy_template | default("ansible_test") }}'
        template_type: fabric_policy
        sites:
          - name: '{{ mso_site | default("ansible_test") }}'
        state: absent

    # CLEAN ENVIRONMENT - REQUIRED FOR TESTS

    - name: Create a fabric_policy template
      cisco.mso.ndo_template:
        <<: *ndo_fabric_policy_template_absent
        state: present

    - name: Create a VLAN pool in the fabric_policy template
      cisco.mso.ndo_vlan_pool:
        <<: *mso_info
        template: '{{ mso_fabric_policy_template | default("ansible_test") }}'
        vlan_pool: ansible_test_vlan_pool_1
        vlan_ranges:
          - from_vlan: 100
            to_vlan: 200
        state: present

    - name: Create a L3 domain in the fabric_policy template
      cisco.mso.ndo_l3_domain:
        <<: *mso_info
        template: '{{ mso_fabric_policy_template | default("ansible_test") }}'
        l3_domain: ansible_test_l3_domain
        pool: ansible_test_vlan_pool_1
        state: present

    - name: Create a interface policy group of type port channel
      cisco.mso.ndo_interface_setting:
        <<: *mso_info
        template: '{{ mso_fabric_policy_template | default("ansible_test") }}'
        name: ansible_test_interface_policy_group_port_channel
        interface_type: port_channel
        state: present

    - name: Create a fabric_resource template
      cisco.mso.ndo_template:
        <<: *ndo_fabric_resource_template_absent
        state: present

    - name: Create port_channel_interface_1 in the fabric_resource template
      cisco.mso.ndo_port_channel_interface:
        <<: *mso_info
        template: '{{ mso_fabric_resource_template | default("ansible_test") }}'
        port_channel_interface: ansible_port_channel_interface_1
        node: 101
        interfaces: 1/20
        interface_policy_group:
          template: '{{ mso_fabric_policy_template | default("ansible_test") }}'
          name: ansible_test_interface_policy_group_port_channel
        state: present
      register: port_channel_interface_1

    - name: Create port_channel_interface_2 in the fabric_resource template
      cisco.mso.ndo_port_channel_interface:
        <<: *mso_info
        template: '{{ mso_fabric_resource_template | default("ansible_test") }}'
        port_channel_interface: ansible_port_channel_interface_2
        node: 102
        interfaces: 1/20
        interface_policy_group:
          template: '{{ mso_fabric_policy_template | default("ansible_test") }}'
          name: ansible_test_interface_policy_group_port_channel
        state: present
      register: port_channel_interface_2

    - name: Create ansible_virtual_port_channel_interface_1 in the fabric_resource template
      cisco.mso.ndo_virtual_port_channel_interface:
        <<: *mso_info
        template: '{{ mso_fabric_resource_template | default("ansible_test") }}'
        name: ansible_virtual_port_channel_interface_1
        node_1: 101
        node_2: 102
        interfaces_node_1:
          - 1/21
        interfaces_node_2:
          - 1/21
        interface_policy_group:
          template: '{{ mso_fabric_policy_template | default("ansible_test") }}'
          name: ansible_test_interface_policy_group_port_channel
        state: present
      register: virtual_port_channel_interface_1

    - name: Create ansible_virtual_port_channel_interface_2 in the fabric_resource template
      cisco.mso.ndo_virtual_port_channel_interface:
        <<: *mso_info
        template: '{{ mso_fabric_resource_template | default("ansible_test") }}'
        name: ansible_virtual_port_channel_interface_2
        node_1: 101
        node_2: 102
        interfaces_node_1:
          - 1/22
        interfaces_node_2:
          - 1/22
        interface_policy_group:
          template: '{{ mso_fabric_policy_template | default("ansible_test") }}'
          name: ansible_test_interface_policy_group_port_channel
        state: present
      register: virtual_port_channel_interface_2

    - name: Create a schema template
      cisco.mso.mso_schema_template:
        <<: *mso_schema_template_absent
        state: present

    - name: Create a VRF in the schema template
      cisco.mso.mso_schema_template_vrf:
        <<: *mso_info
        schema: '{{ mso_schema | default("ansible_test") }}'
        template: template_1
        vrf: vrf_1
        state: present

    - name: Create a new L3Out template
      cisco.mso.ndo_template:
        <<: *ndo_l3out_template_absent
        state: present
      register: l3out_template

    - name: Create L3Out object in the L3Out template
      cisco.mso.ndo_l3out_template:
        <<: *mso_info
        l3out_template: '{{ mso_l3out_template | default("ansible_test") }}'
        name: l3out_1
        vrf:
          name: vrf_1
          schema: '{{ mso_schema | default("ansible_test") }}'
          template: template_1
        l3_domain: ansible_test_l3_domain
        ospf:
          state: enabled
          area_id: 0.0.0.1
          area_type: regular
        bgp:
          state: enabled
        state: present
      register: mso_l3out

    - name: Create L3Out node group policy
      cisco.mso.ndo_l3out_node_group_policy:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        name: node_group_policy_1
        state: present

    - name: Create L3Out interface group policy
      cisco.mso.ndo_l3out_interface_group_policy:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        name: interface_group_policy_1
        state: present

    # CREATE

    - name: Create a L3out svi interface of type port (check mode)
      cisco.mso.ndo_l3out_svi_interface: &create_svi_interface_type_port
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        node_id: 101
        path: eth1/1
        encapsulation_type: vlan
        encapsulation_value: 100
        ipv4_address: 10.0.0.1/24
        mac: 00:22:BD:F8:19:FF
        mtu: inherit
        node_router_id: 1.1.1.1
        state: present
      check_mode: true
      register: cm_create_svi_interface_type_port
    
    - name: Create a L3out svi interface of type port
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port
      register: nm_create_svi_interface_type_port

    - name: Create a L3out svi interface of type port again
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port
      register: nm_create_svi_interface_type_port_again

    - name: Assert that the L3out svi interface of type port was created
      ansible.builtin.assert:
        that:
          - cm_create_svi_interface_type_port is changed
          - cm_create_svi_interface_type_port.previous == {}
          - cm_create_svi_interface_type_port.proposed == cm_create_svi_interface_type_port.current
          - cm_create_svi_interface_type_port.current.addresses.primaryV4 == "10.0.0.1/24"
          - cm_create_svi_interface_type_port.current.addresses.primaryV6 is not defined
          - cm_create_svi_interface_type_port.current.addresses.linkLocalV6 is not defined
          - cm_create_svi_interface_type_port.current.addresses.ipV6DAD is not defined
          - cm_create_svi_interface_type_port.current.encap.encapType == "vlan"
          - cm_create_svi_interface_type_port.current.encap.value == 100
          - cm_create_svi_interface_type_port.current.group is not defined
          - cm_create_svi_interface_type_port.current.mac == "00:22:BD:F8:19:FF"
          - cm_create_svi_interface_type_port.current.mtu == "inherit"
          - cm_create_svi_interface_type_port.current.node.nodeID == "101"
          - cm_create_svi_interface_type_port.current.node.podID == "1"
          - cm_create_svi_interface_type_port.current.node.routerID == "1.1.1.1"
          - cm_create_svi_interface_type_port.current.node.useRouteIDAsLoopback is not defined
          - cm_create_svi_interface_type_port.current.node.loopbackIPs is not defined
          - cm_create_svi_interface_type_port.current.node.group is not defined
          - cm_create_svi_interface_type_port.current.nodeID == "101"
          - cm_create_svi_interface_type_port.current.path == "eth1/1"
          - cm_create_svi_interface_type_port.current.pathRef is not defined
          - cm_create_svi_interface_type_port.current.pathType == "port"
          - cm_create_svi_interface_type_port.current.podID == "1"
          - cm_create_svi_interface_type_port.current.targetDscp is not defined
          - cm_create_svi_interface_type_port.current.templateId is defined
          - cm_create_svi_interface_type_port.current.templateName is defined
          - nm_create_svi_interface_type_port is changed
          - nm_create_svi_interface_type_port.previous == {}
          - nm_create_svi_interface_type_port.proposed == cm_create_svi_interface_type_port.current
          - nm_create_svi_interface_type_port.current != cm_create_svi_interface_type_port.current
          - nm_create_svi_interface_type_port.current.addresses.primaryV4 == "10.0.0.1/24"
          - nm_create_svi_interface_type_port.current.addresses.primaryV6 is not defined
          - nm_create_svi_interface_type_port.current.addresses.linkLocalV6 is not defined
          - nm_create_svi_interface_type_port.current.addresses.ipV6DAD == "enabled"
          - nm_create_svi_interface_type_port.current.encap.encapType == "vlan"
          - nm_create_svi_interface_type_port.current.encap.value == 100
          - nm_create_svi_interface_type_port.current.group == ""
          - nm_create_svi_interface_type_port.current.mac == "00:22:BD:F8:19:FF"
          - nm_create_svi_interface_type_port.current.mtu == "inherit"
          - nm_create_svi_interface_type_port.current.node.group == ""
          - nm_create_svi_interface_type_port.current.node.nodeID == "101"
          - nm_create_svi_interface_type_port.current.node.podID == "1"
          - nm_create_svi_interface_type_port.current.node.routerID == "1.1.1.1"
          - nm_create_svi_interface_type_port.current.node.useRouteIDAsLoopback == false
          - nm_create_svi_interface_type_port.current.node.loopbackIPs is not defined
          - nm_create_svi_interface_type_port.current.nodeID == "101"
          - nm_create_svi_interface_type_port.current.path == "eth1/1"
          - nm_create_svi_interface_type_port.current.pathRef is not defined
          - nm_create_svi_interface_type_port.current.pathType == "port"
          - nm_create_svi_interface_type_port.current.podID == "1"
          - nm_create_svi_interface_type_port.current.targetDscp == "unspecified"
          - nm_create_svi_interface_type_port.current.templateId is defined
          - nm_create_svi_interface_type_port.current.templateName is defined
          - nm_create_svi_interface_type_port.current.svi.autostate == "disabled"
          - nm_create_svi_interface_type_port.current.svi.mode == None
          - nm_create_svi_interface_type_port.current.templateId is defined
          - nm_create_svi_interface_type_port.current.templateName is defined
          - nm_create_svi_interface_type_port_again is not changed
          - nm_create_svi_interface_type_port_again.previous == nm_create_svi_interface_type_port_again.current == nm_create_svi_interface_type_port.current

    - name: Create a L3out svi interface of type port channel with uuid (check mode)
      cisco.mso.ndo_l3out_svi_interface: &create_svi_interface_type_port_channel
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        port_channel:
          uuid: '{{ port_channel_interface_1.current.uuid }}'
        encapsulation_type: vxlan
        encapsulation_value: 50001
        ipv6_address: 1::101/16
        ipv6_dad: disabled
        mac: 00:22:BD:F8:19:EE
        mtu: 2000
        state: present
      check_mode: true
      register: cm_create_svi_interface_type_port_channel

    - name: Create a L3out svi interface of type port channel with uuid
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port_channel
      register: nm_create_svi_interface_type_port_channel

    - name: Create a L3out svi interface of type port channel with uuid again
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port_channel
      register: nm_create_svi_interface_type_port_channel_again
    
    - name: Assert that the L3out svi interface of type port channel with uuid was created
      ansible.builtin.assert:
        that:
          - cm_create_svi_interface_type_port_channel is changed
          - cm_create_svi_interface_type_port_channel.previous == {}
          - cm_create_svi_interface_type_port_channel.proposed == cm_create_svi_interface_type_port_channel.current
          - cm_create_svi_interface_type_port_channel.current.addresses.primaryV4 is not defined
          - cm_create_svi_interface_type_port_channel.current.addresses.primaryV6 == "1::101/16"
          - cm_create_svi_interface_type_port_channel.current.addresses.linkLocalV6 is not defined
          - cm_create_svi_interface_type_port_channel.current.addresses.ipV6DAD == "disabled"
          - cm_create_svi_interface_type_port_channel.current.encap.encapType == "vxlan"
          - cm_create_svi_interface_type_port_channel.current.encap.value == 50001
          - cm_create_svi_interface_type_port_channel.current.group is not defined
          - cm_create_svi_interface_type_port_channel.current.mac == "00:22:BD:F8:19:EE"
          - cm_create_svi_interface_type_port_channel.current.mtu == "2000"
          - cm_create_svi_interface_type_port_channel.current.node.nodeID == "101"
          - cm_create_svi_interface_type_port_channel.current.node.podID == "1"
          - cm_create_svi_interface_type_port_channel.current.node.routerID == "1.1.1.1"
          - cm_create_svi_interface_type_port_channel.current.node.useRouteIDAsLoopback == false
          - cm_create_svi_interface_type_port_channel.current.node.loopbackIPs is not defined
          - cm_create_svi_interface_type_port_channel.current.node.group == ""
          - cm_create_svi_interface_type_port_channel.current.nodeID is not defined
          - cm_create_svi_interface_type_port_channel.current.path is not defined
          - cm_create_svi_interface_type_port_channel.current.pathRef is defined
          - cm_create_svi_interface_type_port_channel.current.pathType == "pc"
          - cm_create_svi_interface_type_port_channel.current.portChannelName == "ansible_port_channel_interface_1"
          - cm_create_svi_interface_type_port_channel.current.portChannelTemplateId is defined
          - cm_create_svi_interface_type_port_channel.current.portChannelTemplateName is defined
          - cm_create_svi_interface_type_port_channel.current.podID is not defined
          - cm_create_svi_interface_type_port_channel.current.targetDscp is not defined
          - cm_create_svi_interface_type_port_channel.current.templateId is defined
          - cm_create_svi_interface_type_port_channel.current.templateName is defined
          - nm_create_svi_interface_type_port_channel is changed
          - nm_create_svi_interface_type_port_channel.previous == {}
          - nm_create_svi_interface_type_port_channel.proposed == cm_create_svi_interface_type_port_channel.current
          - nm_create_svi_interface_type_port_channel.current != cm_create_svi_interface_type_port_channel.current
          - nm_create_svi_interface_type_port_channel.current.addresses.primaryV4 is not defined
          - nm_create_svi_interface_type_port_channel.current.addresses.primaryV6 == "1::101/16"
          - nm_create_svi_interface_type_port_channel.current.addresses.linkLocalV6 is not defined
          - nm_create_svi_interface_type_port_channel.current.addresses.ipV6DAD == "disabled"
          - nm_create_svi_interface_type_port_channel.current.encap.encapType == "vxlan"
          - nm_create_svi_interface_type_port_channel.current.encap.value == 50001
          - nm_create_svi_interface_type_port_channel.current.group == ""
          - nm_create_svi_interface_type_port_channel.current.mac == "00:22:BD:F8:19:EE"
          - nm_create_svi_interface_type_port_channel.current.mtu == "2000"
          - nm_create_svi_interface_type_port_channel.current.node.group == ""
          - nm_create_svi_interface_type_port_channel.current.node.nodeID == "101"
          - nm_create_svi_interface_type_port_channel.current.node.podID == "1"
          - nm_create_svi_interface_type_port_channel.current.node.routerID == "1.1.1.1"
          - nm_create_svi_interface_type_port_channel.current.node.useRouteIDAsLoopback == false
          - nm_create_svi_interface_type_port_channel.current.node.loopbackIPs is not defined
          - nm_create_svi_interface_type_port_channel.current.nodeID is not defined
          - nm_create_svi_interface_type_port_channel.current.path is not defined
          - nm_create_svi_interface_type_port_channel.current.pathRef is defined
          - nm_create_svi_interface_type_port_channel.current.pathType == "pc"
          - nm_create_svi_interface_type_port_channel.current.portChannelName == "ansible_port_channel_interface_1"
          - nm_create_svi_interface_type_port_channel.current.portChannelTemplateId is defined
          - nm_create_svi_interface_type_port_channel.current.portChannelTemplateName is defined
          - nm_create_svi_interface_type_port_channel.current.podID is not defined
          - nm_create_svi_interface_type_port_channel.current.targetDscp == "unspecified"
          - nm_create_svi_interface_type_port_channel.current.svi.autostate == "disabled"
          - nm_create_svi_interface_type_port_channel.current.svi.mode == None
          - nm_create_svi_interface_type_port_channel.current.templateId is defined
          - nm_create_svi_interface_type_port_channel.current.templateName is defined
          - nm_create_svi_interface_type_port_channel_again is not changed
          - nm_create_svi_interface_type_port_channel_again.previous == nm_create_svi_interface_type_port_channel_again.current == nm_create_svi_interface_type_port_channel.current

    - name: Create a L3out svi interface of type virtual port channel with reference (check mode)
      cisco.mso.ndo_l3out_svi_interface: &create_svi_interface_type_virtual_port_channel
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        encapsulation_type: vlan
        encapsulation_value: 1000
        node_router_id: 1.1.1.1
        ipv4_address: 10.0.2.1/24
        mac: 00:22:BD:F8:19:AA
        mtu: 2500
        virtual_port_channel: 
          reference:
            name: ansible_virtual_port_channel_interface_1
            template: '{{ mso_fabric_resource_template | default("ansible_test") }}'
          side_b_ipv4_address: 10.0.2.2/24
          side_b_node_router_id: 2.2.2.2
        state: present
      check_mode: true
      register: cm_create_svi_interface_type_virtual_port_channel

    - name: Create a L3out svi interface of type virtual port channel with reference
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_virtual_port_channel
      register: nm_create_svi_interface_type_virtual_port_channel

    - name: Create a L3out svi interface of type virtual port channel with reference again
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_virtual_port_channel
      register: nm_create_svi_interface_type_virtual_port_channel_again

    - name: Assert that the L3out svi interface of type virtual port channel with reference was created
      ansible.builtin.assert:
        that:
          - cm_create_svi_interface_type_virtual_port_channel is changed
          - cm_create_svi_interface_type_virtual_port_channel.previous == {}
          - cm_create_svi_interface_type_virtual_port_channel.proposed == cm_create_svi_interface_type_virtual_port_channel.current
          - cm_create_svi_interface_type_virtual_port_channel.current.addresses.primaryV4 == "10.0.2.1/24"
          - cm_create_svi_interface_type_virtual_port_channel.current.addresses.primaryV6 is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.addresses.linkLocalV6 is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.addresses.ipV6DAD is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.sideBAddresses.primaryV4 == "10.0.2.2/24"
          - cm_create_svi_interface_type_virtual_port_channel.current.sideBAddresses.primaryV6 is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.sideBAddresses.linkLocalV6 is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.sideBAddresses.ipV6DAD is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.encap.encapType == "vlan"
          - cm_create_svi_interface_type_virtual_port_channel.current.encap.value == 1000
          - cm_create_svi_interface_type_virtual_port_channel.current.group is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.mac == "00:22:BD:F8:19:AA"
          - cm_create_svi_interface_type_virtual_port_channel.current.mtu == "2500"
          - cm_create_svi_interface_type_virtual_port_channel.current.node.nodeID == "101"
          - cm_create_svi_interface_type_virtual_port_channel.current.node.podID == "1"
          - cm_create_svi_interface_type_virtual_port_channel.current.node.routerID == "1.1.1.1"
          - cm_create_svi_interface_type_virtual_port_channel.current.node.useRouteIDAsLoopback == false
          - cm_create_svi_interface_type_virtual_port_channel.current.node.loopbackIPs is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.node.group == ""
          - cm_create_svi_interface_type_virtual_port_channel.current.sideBNode.nodeID == "102"
          - cm_create_svi_interface_type_virtual_port_channel.current.sideBNode.podID == "1"
          - cm_create_svi_interface_type_virtual_port_channel.current.sideBNode.routerID == "2.2.2.2"
          - cm_create_svi_interface_type_virtual_port_channel.current.sideBNode.useRouteIDAsLoopback is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.sideBNode.loopbackIPs is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.sideBNode.group is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.nodeID is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.path is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.pathRef is defined
          - cm_create_svi_interface_type_virtual_port_channel.current.pathType == "vpc"
          - cm_create_svi_interface_type_virtual_port_channel.current.virtualPortChannelName == "ansible_virtual_port_channel_interface_1"
          - cm_create_svi_interface_type_virtual_port_channel.current.virtualPortChannelTemplateId is defined
          - cm_create_svi_interface_type_virtual_port_channel.current.virtualPortChannelTemplateName is defined
          - cm_create_svi_interface_type_virtual_port_channel.current.podID is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.targetDscp is not defined
          - cm_create_svi_interface_type_virtual_port_channel.current.templateId is defined
          - cm_create_svi_interface_type_virtual_port_channel.current.templateName is defined
          - nm_create_svi_interface_type_virtual_port_channel is changed
          - nm_create_svi_interface_type_virtual_port_channel.previous == {}
          - nm_create_svi_interface_type_virtual_port_channel.proposed == cm_create_svi_interface_type_virtual_port_channel.current
          - nm_create_svi_interface_type_virtual_port_channel.current != cm_create_svi_interface_type_virtual_port_channel.current
          - nm_create_svi_interface_type_virtual_port_channel.current.addresses.primaryV4 == "10.0.2.1/24"
          - nm_create_svi_interface_type_virtual_port_channel.current.addresses.primaryV6 is not defined
          - nm_create_svi_interface_type_virtual_port_channel.current.addresses.linkLocalV6 is not defined
          - nm_create_svi_interface_type_virtual_port_channel.current.addresses.ipV6DAD == "enabled"
          - nm_create_svi_interface_type_virtual_port_channel.current.sideBAddresses.primaryV4 == "10.0.2.2/24"
          - nm_create_svi_interface_type_virtual_port_channel.current.sideBAddresses.primaryV6 is not defined
          - nm_create_svi_interface_type_virtual_port_channel.current.sideBAddresses.linkLocalV6 is not defined
          - nm_create_svi_interface_type_virtual_port_channel.current.sideBAddresses.ipV6DAD == "enabled"
          - nm_create_svi_interface_type_virtual_port_channel.current.encap.encapType == "vlan"
          - nm_create_svi_interface_type_virtual_port_channel.current.encap.value == 1000
          - nm_create_svi_interface_type_virtual_port_channel.current.group == ""
          - nm_create_svi_interface_type_virtual_port_channel.current.mac == "00:22:BD:F8:19:AA"
          - nm_create_svi_interface_type_virtual_port_channel.current.mtu == "2500"
          - nm_create_svi_interface_type_virtual_port_channel.current.node.group == ""
          - nm_create_svi_interface_type_virtual_port_channel.current.node.nodeID == "101"
          - nm_create_svi_interface_type_virtual_port_channel.current.node.podID == "1"
          - nm_create_svi_interface_type_virtual_port_channel.current.node.routerID == "1.1.1.1"
          - nm_create_svi_interface_type_virtual_port_channel.current.node.useRouteIDAsLoopback == false
          - nm_create_svi_interface_type_virtual_port_channel.current.node.loopbackIPs is not defined
          - nm_create_svi_interface_type_virtual_port_channel.current.sideBNode.group == ""
          - nm_create_svi_interface_type_virtual_port_channel.current.sideBNode.nodeID == "102"
          - nm_create_svi_interface_type_virtual_port_channel.current.sideBNode.podID == "1"
          - nm_create_svi_interface_type_virtual_port_channel.current.sideBNode.routerID == "2.2.2.2"
          - nm_create_svi_interface_type_virtual_port_channel.current.sideBNode.useRouteIDAsLoopback == false
          - nm_create_svi_interface_type_virtual_port_channel.current.sideBNode.loopbackIPs is not defined
          - nm_create_svi_interface_type_virtual_port_channel.current.nodeID is not defined
          - nm_create_svi_interface_type_virtual_port_channel.current.path is not defined
          - nm_create_svi_interface_type_virtual_port_channel.current.pathRef is defined
          - nm_create_svi_interface_type_virtual_port_channel.current.pathType == "vpc"
          - nm_create_svi_interface_type_virtual_port_channel.current.virtualPortChannelName == "ansible_virtual_port_channel_interface_1"
          - nm_create_svi_interface_type_virtual_port_channel.current.virtualPortChannelTemplateId is defined
          - nm_create_svi_interface_type_virtual_port_channel.current.virtualPortChannelTemplateName is defined
          - nm_create_svi_interface_type_virtual_port_channel.current.podID is not defined
          - nm_create_svi_interface_type_virtual_port_channel.current.targetDscp == "unspecified"
          - nm_create_svi_interface_type_virtual_port_channel.current.svi.autostate == "disabled"
          - nm_create_svi_interface_type_virtual_port_channel.current.svi.mode == None
          - nm_create_svi_interface_type_virtual_port_channel.current.templateId is defined
          - nm_create_svi_interface_type_virtual_port_channel.current.templateName is defined
          - nm_create_svi_interface_type_virtual_port_channel_again is not changed
          - nm_create_svi_interface_type_virtual_port_channel_again.previous == nm_create_svi_interface_type_virtual_port_channel_again.current == nm_create_svi_interface_type_virtual_port_channel.current

    # UPDATE

    - name: Update a L3out svi interface of type port (check mode)
      cisco.mso.ndo_l3out_svi_interface: &update_svi_interface_type_port
        <<: *create_svi_interface_type_port
        ipv4_address: 10.0.0.2/24
        ipv6_address: 2::101/16
        ipv6_link_local_address: FE80::10
        ipv6_dad: disabled
        encapsulation_type: vxlan
        encapsulation_value: 5100
        mac: 00:22:BD:F8:19:FE
        mtu: 1000
        interface_group_policy: interface_group_policy_1
        target_dscp: af11
        encapsulation_scope: vrf
        encapsulation_mode: trunk
        auto_state: enabled
      check_mode: true
      register: cm_update_svi_interface_type_port

    - name: Update a L3out svi interface of type port
      cisco.mso.ndo_l3out_svi_interface:
        <<: *update_svi_interface_type_port
      register: nm_update_svi_interface_type_port

    - name: Update a L3out svi interface of type port again
      cisco.mso.ndo_l3out_svi_interface:
        <<: *update_svi_interface_type_port
      register: nm_update_svi_interface_type_port_again

    - name: Assert that the L3out svi interface of type port was updated
      ansible.builtin.assert:
        that:
          - cm_update_svi_interface_type_port is changed
          - cm_update_svi_interface_type_port.previous == nm_create_svi_interface_type_port_again.current
          - cm_update_svi_interface_type_port.previous != cm_update_svi_interface_type_port.current
          - cm_update_svi_interface_type_port.proposed == cm_update_svi_interface_type_port.current
          - cm_update_svi_interface_type_port.current.addresses.primaryV4 == "10.0.0.2/24"
          - cm_update_svi_interface_type_port.current.addresses.primaryV6 == "2::101/16"
          - cm_update_svi_interface_type_port.current.addresses.linkLocalV6 == "FE80::10"
          - cm_update_svi_interface_type_port.current.addresses.ipV6DAD == "disabled"
          - cm_update_svi_interface_type_port.current.encap.encapType == "vxlan"
          - cm_update_svi_interface_type_port.current.encap.value == 5100
          - cm_update_svi_interface_type_port.current.group == "interface_group_policy_1"
          - cm_update_svi_interface_type_port.current.mac == "00:22:BD:F8:19:FE"
          - cm_update_svi_interface_type_port.current.mtu == "1000"
          - cm_update_svi_interface_type_port.current.node.group == ""
          - cm_update_svi_interface_type_port.current.node.nodeID == "101"
          - cm_update_svi_interface_type_port.current.node.podID == "1"
          - cm_update_svi_interface_type_port.current.node.routerID == "1.1.1.1"
          - cm_update_svi_interface_type_port.current.node.useRouteIDAsLoopback == false
          - cm_update_svi_interface_type_port.current.node.loopbackIPs is not defined
          - cm_update_svi_interface_type_port.current.nodeID == "101"
          - cm_update_svi_interface_type_port.current.path == "eth1/1"
          - cm_update_svi_interface_type_port.current.pathRef is not defined
          - cm_update_svi_interface_type_port.current.pathType == "port"
          - cm_update_svi_interface_type_port.current.podID == "1"
          - cm_update_svi_interface_type_port.current.targetDscp == "af11"
          - cm_update_svi_interface_type_port.current.svi.autostate == "enabled"
          - cm_update_svi_interface_type_port.current.svi.mode == "trunk"
          - cm_update_svi_interface_type_port.current.templateId is defined
          - cm_update_svi_interface_type_port.current.templateName is defined
          - nm_update_svi_interface_type_port is changed
          - nm_update_svi_interface_type_port is changed
          - nm_update_svi_interface_type_port.previous == nm_create_svi_interface_type_port_again.current
          - nm_update_svi_interface_type_port.previous != nm_update_svi_interface_type_port.current
          - nm_update_svi_interface_type_port.proposed == nm_update_svi_interface_type_port.current == cm_update_svi_interface_type_port.current
          - nm_update_svi_interface_type_port_again is not changed
          - nm_update_svi_interface_type_port_again.previous == nm_update_svi_interface_type_port_again.current == nm_update_svi_interface_type_port.current

    - name: Update a L3out svi interface of type port channel with reference (check mode)
      cisco.mso.ndo_l3out_svi_interface: &update_svi_interface_type_port_channel
        <<: *create_svi_interface_type_port_channel
        port_channel:
          reference:
            name: '{{ port_channel_interface_1.current.name }}'
            template_id: '{{ port_channel_interface_1.current.templateId }}'
        encapsulation_type: vlan
        encapsulation_value: 1200
        ipv4_address: 10.0.1.1/24
        ipv6_address: 1::102/16
        ipv6_dad: disabled
        ipv6_link_local_address: FE80::12
        mac: 00:22:BD:F8:19:CC
        mtu: 1800
        interface_group_policy: interface_group_policy_1
        target_dscp: af41
        encapsulation_scope: local
        encapsulation_mode: access
        auto_state: enabled
      check_mode: true
      register: cm_update_svi_interface_type_port_channel

    - name: Update a L3out svi interface of type port channel with reference
      cisco.mso.ndo_l3out_svi_interface:
        <<: *update_svi_interface_type_port_channel
      register: nm_update_svi_interface_type_port_channel

    - name: Update a L3out svi interface of type port channel with reference again
      cisco.mso.ndo_l3out_svi_interface:
        <<: *update_svi_interface_type_port_channel
      register: nm_update_svi_interface_type_port_channel_again

    - name: Assert that the L3out svi interface of type port channel with reference was updated
      ansible.builtin.assert:
        that:
          - cm_update_svi_interface_type_port_channel is changed
          - cm_update_svi_interface_type_port_channel.previous == nm_create_svi_interface_type_port_channel_again.current
          - cm_update_svi_interface_type_port_channel.previous != cm_update_svi_interface_type_port_channel.current
          - cm_update_svi_interface_type_port_channel.proposed == cm_update_svi_interface_type_port_channel.current
          - cm_update_svi_interface_type_port_channel.current.addresses.primaryV4 == "10.0.1.1/24"
          - cm_update_svi_interface_type_port_channel.current.addresses.primaryV6 == "1::102/16"
          - cm_update_svi_interface_type_port_channel.current.addresses.linkLocalV6 == "FE80::12"
          - cm_update_svi_interface_type_port_channel.current.addresses.ipV6DAD == "disabled"
          - cm_update_svi_interface_type_port_channel.current.encap.encapType == "vlan"
          - cm_update_svi_interface_type_port_channel.current.encap.value == 1200
          - cm_update_svi_interface_type_port_channel.current.group == "interface_group_policy_1"
          - cm_update_svi_interface_type_port_channel.current.mac == "00:22:BD:F8:19:CC"
          - cm_update_svi_interface_type_port_channel.current.mtu == "1800"
          - cm_update_svi_interface_type_port_channel.current.node.group == ""
          - cm_update_svi_interface_type_port_channel.current.node.nodeID == "101"
          - cm_update_svi_interface_type_port_channel.current.node.podID == "1"
          - cm_update_svi_interface_type_port_channel.current.node.routerID == "1.1.1.1"
          - cm_update_svi_interface_type_port_channel.current.node.useRouteIDAsLoopback == false
          - cm_update_svi_interface_type_port_channel.current.node.loopbackIPs is not defined
          - cm_update_svi_interface_type_port_channel.current.nodeID is not defined
          - cm_update_svi_interface_type_port_channel.current.path is not defined
          - cm_update_svi_interface_type_port_channel.current.pathRef is defined
          - cm_update_svi_interface_type_port_channel.current.pathType == "pc"
          - cm_update_svi_interface_type_port_channel.current.portChannelName == "ansible_port_channel_interface_1"
          - cm_update_svi_interface_type_port_channel.current.portChannelTemplateId is defined
          - cm_update_svi_interface_type_port_channel.current.portChannelTemplateName is defined
          - cm_update_svi_interface_type_port_channel.current.podID is not defined
          - cm_update_svi_interface_type_port_channel.current.targetDscp == "af41"
          - cm_update_svi_interface_type_port_channel.current.svi.autostate == "enabled"
          - cm_update_svi_interface_type_port_channel.current.svi.mode == "access"
          - cm_update_svi_interface_type_port_channel.current.svi.encapScope == "local"
          - cm_update_svi_interface_type_port_channel.current.templateId is defined
          - cm_update_svi_interface_type_port_channel.current.templateName is defined
          - nm_update_svi_interface_type_port_channel is changed
          - nm_update_svi_interface_type_port_channel.previous == nm_create_svi_interface_type_port_channel_again.current
          - nm_update_svi_interface_type_port_channel.previous != nm_update_svi_interface_type_port_channel.current
          - nm_update_svi_interface_type_port_channel.proposed == nm_update_svi_interface_type_port_channel.current
          - nm_update_svi_interface_type_port_channel.current.addresses.primaryV4 == "10.0.1.1/24"
          - nm_update_svi_interface_type_port_channel.current.addresses.primaryV6 == "1::102/16"
          - nm_update_svi_interface_type_port_channel.current.addresses.linkLocalV6 == "FE80::12"
          - nm_update_svi_interface_type_port_channel.current.addresses.ipV6DAD == "disabled"
          - nm_update_svi_interface_type_port_channel.current.encap.encapType == "vlan"
          - nm_update_svi_interface_type_port_channel.current.encap.value == 1200
          - nm_update_svi_interface_type_port_channel.current.group == "interface_group_policy_1"
          - nm_update_svi_interface_type_port_channel.current.mac == "00:22:BD:F8:19:CC"
          - nm_update_svi_interface_type_port_channel.current.mtu == "1800"
          - nm_update_svi_interface_type_port_channel.current.node.group == ""
          - nm_update_svi_interface_type_port_channel.current.node.nodeID == "101"
          - nm_update_svi_interface_type_port_channel.current.node.podID == "1"
          - nm_update_svi_interface_type_port_channel.current.node.routerID == "1.1.1.1"
          - nm_update_svi_interface_type_port_channel.current.node.useRouteIDAsLoopback == false
          - nm_update_svi_interface_type_port_channel.current.node.loopbackIPs is not defined
          - nm_update_svi_interface_type_port_channel.current.nodeID is not defined
          - nm_update_svi_interface_type_port_channel.current.path is not defined
          - nm_update_svi_interface_type_port_channel.current.pathRef is defined
          - nm_update_svi_interface_type_port_channel.current.pathType == "pc"
          - nm_update_svi_interface_type_port_channel.current.portChannelName == "ansible_port_channel_interface_1"
          - nm_update_svi_interface_type_port_channel.current.portChannelTemplateId is defined
          - nm_update_svi_interface_type_port_channel.current.portChannelTemplateName is defined
          - nm_update_svi_interface_type_port_channel.current.podID is not defined
          - nm_update_svi_interface_type_port_channel.current.targetDscp == "af41"
          - nm_update_svi_interface_type_port_channel.current.svi.autostate == "enabled"
          - nm_update_svi_interface_type_port_channel.current.svi.mode == "access"
          - nm_update_svi_interface_type_port_channel.current.svi.encapScope == "local"
          - nm_update_svi_interface_type_port_channel.current.templateId is defined
          - nm_update_svi_interface_type_port_channel.current.templateName is defined
          - nm_update_svi_interface_type_port_channel_again is not changed
          - nm_update_svi_interface_type_port_channel_again.previous == nm_update_svi_interface_type_port_channel_again.current == nm_update_svi_interface_type_port_channel.current

    - name: Update a L3out svi interface of type virtual port channel with uuid (check mode)
      cisco.mso.ndo_l3out_svi_interface: &update_svi_interface_type_virtual_port_channel
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        encapsulation_type: vxlan
        encapsulation_value: 51000
        node_router_id: 1.1.1.1
        ipv4_address: 10.0.2.4/24
        ipv6_address: 10::105/16
        ipv6_dad: disabled
        ipv6_link_local_address: FE80::14
        mac: 00:22:BD:F8:19:AD
        mtu: 9216
        virtual_port_channel: 
          uuid: '{{ virtual_port_channel_interface_1.current.uuid }}'
          side_b_ipv4_address: 10.0.2.5/24
          side_b_ipv6_address: 10::106/16
          side_b_ipv6_link_local_address: FE80::15
          side_b_ipv6_dad: disabled
          side_b_node_router_id: 2.2.2.2
          side_b_node_group_policy: node_group_policy_1
        interface_group_policy: interface_group_policy_1
        node_group_policy: node_group_policy_1
        target_dscp: cs5
        encapsulation_scope: vrf
        encapsulation_mode: trunk_native
        auto_state: enabled
        state: present
      check_mode: true
      register: cm_update_svi_interface_type_virtual_port_channel
    
    - name: Update a L3out svi interface of type virtual port channel with uuid
      cisco.mso.ndo_l3out_svi_interface:
        <<: *update_svi_interface_type_virtual_port_channel
      register: nm_update_svi_interface_type_virtual_port_channel

    - name: Update a L3out svi interface of type virtual port channel with uuid again
      cisco.mso.ndo_l3out_svi_interface:
        <<: *update_svi_interface_type_virtual_port_channel
      register: nm_update_svi_interface_type_virtual_port_channel_again

    - name: Assert that the L3out svi interface of type virtual port channel with uuid was updated
      ansible.builtin.assert:
        that:
          - cm_update_svi_interface_type_virtual_port_channel is changed
          - cm_update_svi_interface_type_virtual_port_channel.previous == nm_create_svi_interface_type_virtual_port_channel_again.current
          - cm_update_svi_interface_type_virtual_port_channel.previous != cm_update_svi_interface_type_virtual_port_channel.current
          - cm_update_svi_interface_type_virtual_port_channel.proposed == cm_update_svi_interface_type_virtual_port_channel.current
          - cm_update_svi_interface_type_virtual_port_channel.current.addresses.primaryV4 == "10.0.2.4/24"
          - cm_update_svi_interface_type_virtual_port_channel.current.addresses.primaryV6 == "10::105/16"
          - cm_update_svi_interface_type_virtual_port_channel.current.addresses.linkLocalV6 == "FE80::14"
          - cm_update_svi_interface_type_virtual_port_channel.current.addresses.ipV6DAD == "disabled"
          - cm_update_svi_interface_type_virtual_port_channel.current.sideBAddresses.primaryV4 == "10.0.2.5/24"
          - cm_update_svi_interface_type_virtual_port_channel.current.sideBAddresses.primaryV6 == "10::106/16"
          - cm_update_svi_interface_type_virtual_port_channel.current.sideBAddresses.linkLocalV6 == "FE80::15"
          - cm_update_svi_interface_type_virtual_port_channel.current.sideBAddresses.ipV6DAD == "disabled"
          - cm_update_svi_interface_type_virtual_port_channel.current.encap.encapType == "vxlan"
          - cm_update_svi_interface_type_virtual_port_channel.current.encap.value == 51000
          - cm_update_svi_interface_type_virtual_port_channel.current.group == "interface_group_policy_1"
          - cm_update_svi_interface_type_virtual_port_channel.current.mac == "00:22:BD:F8:19:AD"
          - cm_update_svi_interface_type_virtual_port_channel.current.mtu == "9216"
          - cm_update_svi_interface_type_virtual_port_channel.current.node.nodeID == "101"
          - cm_update_svi_interface_type_virtual_port_channel.current.node.podID == "1"
          - cm_update_svi_interface_type_virtual_port_channel.current.node.routerID == "1.1.1.1"
          - cm_update_svi_interface_type_virtual_port_channel.current.node.useRouteIDAsLoopback == false
          - cm_update_svi_interface_type_virtual_port_channel.current.node.loopbackIPs is not defined
          - cm_update_svi_interface_type_virtual_port_channel.current.node.group == "node_group_policy_1"
          - cm_update_svi_interface_type_virtual_port_channel.current.sideBNode.nodeID == "102"
          - cm_update_svi_interface_type_virtual_port_channel.current.sideBNode.podID == "1"
          - cm_update_svi_interface_type_virtual_port_channel.current.sideBNode.routerID == "2.2.2.2"
          - cm_update_svi_interface_type_virtual_port_channel.current.sideBNode.useRouteIDAsLoopback == false
          - cm_update_svi_interface_type_virtual_port_channel.current.sideBNode.loopbackIPs is not defined
          - cm_update_svi_interface_type_virtual_port_channel.current.sideBNode.group == "node_group_policy_1"
          - cm_update_svi_interface_type_virtual_port_channel.current.nodeID is not defined
          - cm_update_svi_interface_type_virtual_port_channel.current.path is not defined
          - cm_update_svi_interface_type_virtual_port_channel.current.pathRef is defined
          - cm_update_svi_interface_type_virtual_port_channel.current.pathType == "vpc"
          - cm_update_svi_interface_type_virtual_port_channel.current.virtualPortChannelName == "ansible_virtual_port_channel_interface_1"
          - cm_update_svi_interface_type_virtual_port_channel.current.virtualPortChannelTemplateId is defined
          - cm_update_svi_interface_type_virtual_port_channel.current.virtualPortChannelTemplateName is defined
          - cm_update_svi_interface_type_virtual_port_channel.current.podID is not defined
          - cm_update_svi_interface_type_virtual_port_channel.current.targetDscp == "cs5"
          - cm_update_svi_interface_type_virtual_port_channel.current.svi.autostate == "enabled"
          - cm_update_svi_interface_type_virtual_port_channel.current.svi.mode == "access8021p"
          - cm_update_svi_interface_type_virtual_port_channel.current.svi.encapScope == "vrf"
          - cm_update_svi_interface_type_virtual_port_channel.current.templateId is defined
          - cm_update_svi_interface_type_virtual_port_channel.current.templateName is defined
          - nm_update_svi_interface_type_virtual_port_channel is changed
          - nm_update_svi_interface_type_virtual_port_channel.previous == nm_create_svi_interface_type_virtual_port_channel_again.current
          - nm_update_svi_interface_type_virtual_port_channel.previous != nm_update_svi_interface_type_virtual_port_channel.current
          - nm_update_svi_interface_type_virtual_port_channel.proposed == nm_update_svi_interface_type_virtual_port_channel.current
          - nm_update_svi_interface_type_virtual_port_channel.current.addresses.primaryV4 == "10.0.2.4/24"
          - nm_update_svi_interface_type_virtual_port_channel.current.addresses.primaryV6 == "10::105/16"
          - nm_update_svi_interface_type_virtual_port_channel.current.addresses.linkLocalV6 == "FE80::14"
          - nm_update_svi_interface_type_virtual_port_channel.current.addresses.ipV6DAD == "disabled"
          - nm_update_svi_interface_type_virtual_port_channel.current.sideBAddresses.primaryV4 == "10.0.2.5/24"
          - nm_update_svi_interface_type_virtual_port_channel.current.sideBAddresses.primaryV6 == "10::106/16"
          - nm_update_svi_interface_type_virtual_port_channel.current.sideBAddresses.linkLocalV6 == "FE80::15"
          - nm_update_svi_interface_type_virtual_port_channel.current.sideBAddresses.ipV6DAD == "disabled"
          - nm_update_svi_interface_type_virtual_port_channel.current.encap.encapType == "vxlan"
          - nm_update_svi_interface_type_virtual_port_channel.current.encap.value == 51000
          - nm_update_svi_interface_type_virtual_port_channel.current.group == "interface_group_policy_1"
          - nm_update_svi_interface_type_virtual_port_channel.current.mac == "00:22:BD:F8:19:AD"
          - nm_update_svi_interface_type_virtual_port_channel.current.mtu == "9216"
          - nm_update_svi_interface_type_virtual_port_channel.current.node.nodeID == "101"
          - nm_update_svi_interface_type_virtual_port_channel.current.node.podID == "1"
          - nm_update_svi_interface_type_virtual_port_channel.current.node.routerID == "1.1.1.1"
          - nm_update_svi_interface_type_virtual_port_channel.current.node.useRouteIDAsLoopback == false
          - nm_update_svi_interface_type_virtual_port_channel.current.node.loopbackIPs is not defined
          - nm_update_svi_interface_type_virtual_port_channel.current.node.group == "node_group_policy_1"
          - nm_update_svi_interface_type_virtual_port_channel.current.sideBNode.nodeID == "102"
          - nm_update_svi_interface_type_virtual_port_channel.current.sideBNode.podID == "1"
          - nm_update_svi_interface_type_virtual_port_channel.current.sideBNode.routerID == "2.2.2.2"
          - nm_update_svi_interface_type_virtual_port_channel.current.sideBNode.useRouteIDAsLoopback == false
          - nm_update_svi_interface_type_virtual_port_channel.current.sideBNode.loopbackIPs is not defined
          - nm_update_svi_interface_type_virtual_port_channel.current.sideBNode.group == "node_group_policy_1"
          - nm_update_svi_interface_type_virtual_port_channel.current.nodeID is not defined
          - nm_update_svi_interface_type_virtual_port_channel.current.path is not defined
          - nm_update_svi_interface_type_virtual_port_channel.current.pathRef is defined
          - nm_update_svi_interface_type_virtual_port_channel.current.pathType == "vpc"
          - nm_update_svi_interface_type_virtual_port_channel.current.virtualPortChannelName == "ansible_virtual_port_channel_interface_1"
          - nm_update_svi_interface_type_virtual_port_channel.current.virtualPortChannelTemplateId is defined
          - nm_update_svi_interface_type_virtual_port_channel.current.virtualPortChannelTemplateName is defined
          - nm_update_svi_interface_type_virtual_port_channel.current.podID is not defined
          - nm_update_svi_interface_type_virtual_port_channel.current.targetDscp == "cs5"
          - nm_update_svi_interface_type_virtual_port_channel.current.svi.autostate == "enabled"
          - nm_update_svi_interface_type_virtual_port_channel.current.svi.mode == "access8021p"
          - nm_update_svi_interface_type_virtual_port_channel.current.svi.encapScope == "vrf"
          - nm_update_svi_interface_type_virtual_port_channel.current.templateId is defined
          - nm_update_svi_interface_type_virtual_port_channel.current.templateName is defined
          - nm_update_svi_interface_type_virtual_port_channel_again is not changed
          - nm_update_svi_interface_type_virtual_port_channel_again.previous == nm_update_svi_interface_type_virtual_port_channel_again.current == nm_update_svi_interface_type_virtual_port_channel.current

    - name: Remove the ipv4_address from a L3out svi interface of type port channel
      cisco.mso.ndo_l3out_svi_interface: &removed_ipv4_address
        <<: *update_svi_interface_type_port_channel
        ipv4_address: ''
      register: nm_update_svi_interface_type_port_channel_ipv4_removed

    - name: Remove the ipv6_address from a L3out svi interface of type virtual port channel
      cisco.mso.ndo_l3out_svi_interface:
        <<: *update_svi_interface_type_virtual_port_channel
        ipv6_address: ''
        virtual_port_channel: 
          uuid: '{{ virtual_port_channel_interface_1.current.uuid }}'
          side_b_ipv6_address: ''
      register: nm_update_svi_interface_type_virtual_port_channel_ipv6_removed

    - name: Remove the ipv6_link_local_address from a L3out svi interface of type port channel
      cisco.mso.ndo_l3out_svi_interface:
        <<: *removed_ipv4_address
        ipv6_link_local_address: ''
      register: nm_update_svi_interface_type_port_channel_ipv6_link_local_removed

    - name: Assert that the ipv4_address, ipv6_address and ipv6_link_local_address were removed
      ansible.builtin.assert:
        that:
          - nm_update_svi_interface_type_port_channel_ipv4_removed is changed
          - nm_update_svi_interface_type_port_channel_ipv4_removed.previous.addresses.primaryV4 == "10.0.1.1/24"
          - nm_update_svi_interface_type_port_channel_ipv4_removed.current.addresses.primaryV4 is not defined
          - nm_update_svi_interface_type_virtual_port_channel_ipv6_removed is changed
          - nm_update_svi_interface_type_virtual_port_channel_ipv6_removed.previous.addresses.primaryV6 == "10::105/16"
          - nm_update_svi_interface_type_virtual_port_channel_ipv6_removed.current.addresses.primaryV6 is not defined
          - nm_update_svi_interface_type_port_channel_ipv6_link_local_removed is changed
          - nm_update_svi_interface_type_port_channel_ipv6_link_local_removed.previous.addresses.linkLocalV6 == "FE80::12"
          - nm_update_svi_interface_type_port_channel_ipv6_link_local_removed.current.addresses.linkLocalV6 is not defined

    - name: Update a L3out svi interface of type virtual port channel to use defined loopback as router id
      cisco.mso.ndo_l3out_svi_interface:
        <<: *update_svi_interface_type_virtual_port_channel
        use_router_id_as_loopback: false
        node_loopback_ip: 3.3.3.3
      register: nm_update_svi_interface_type_virtual_port_channel_defined_loopback_as_router_id

    - name: Update a L3out svi interface of type virtual port channel to use router id as loopback
      cisco.mso.ndo_l3out_svi_interface:
        <<: *update_svi_interface_type_virtual_port_channel
        use_router_id_as_loopback: true
        node_loopback_ip: ""
      register: nm_update_svi_interface_type_virtual_port_channel_router_id_as_loopback

    - name: Assert that the L3out svi interface of type virtual port channel with router id as loopback was updated
      ansible.builtin.assert:
        that:
          - nm_update_svi_interface_type_virtual_port_channel_defined_loopback_as_router_id is changed
          - nm_update_svi_interface_type_virtual_port_channel_defined_loopback_as_router_id.previous.node.useRouteIDAsLoopback == false
          - nm_update_svi_interface_type_virtual_port_channel_defined_loopback_as_router_id.previous.node.loopbackIPs is not defined
          - nm_update_svi_interface_type_virtual_port_channel_defined_loopback_as_router_id.current.node.useRouteIDAsLoopback == false
          - nm_update_svi_interface_type_virtual_port_channel_defined_loopback_as_router_id.current.node.loopbackIPs == ["3.3.3.3"]
          - nm_update_svi_interface_type_virtual_port_channel_router_id_as_loopback is changed
          - nm_update_svi_interface_type_virtual_port_channel_router_id_as_loopback.previous.node.useRouteIDAsLoopback == false
          - nm_update_svi_interface_type_virtual_port_channel_router_id_as_loopback.previous.node.loopbackIPs == ["3.3.3.3"]
          - nm_update_svi_interface_type_virtual_port_channel_router_id_as_loopback.current.node.useRouteIDAsLoopback == true
          - nm_update_svi_interface_type_virtual_port_channel_router_id_as_loopback.current.node.loopbackIPs is not defined

    # ERROR HANDLING

    - name: Create L3out svi interface with template and template_id
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port_channel
        template: l3out_template.current.name
        template_id: l3out_template.current.templateId
      register: error_svi_interface_template_and_template_id
      ignore_errors: true

    - name: Create L3out svi interface with l3out and l3out_uuid
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port_channel
        l3out: mso_l3out.current.name
        l3out_uuid: mso_l3out.current.uuid
      register: error_svi_interface_l3out_and_l3out_uuid
      ignore_errors: true

    - name: Create L3out svi interface without template or template_id
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        l3out: l3out_1
        state: present
      register: error_svi_interface_without_template_or_template_id
      ignore_errors: true

    - name: Create L3out svi interface without l3out or l3out_uuid
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        state: present
      register: error_svi_interface_without_l3out_or_l3out_uuid
      ignore_errors: true

    - name: Create L3out svi interface without path, port_channel, or virtual_port_channel
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        state: present
      register: error_create_svi_interface_without_path_or_port_channel_or_virtual_port_channel
      ignore_errors: true

    - name: Delete L3out svi interface without path, port_channel, or virtual_port_channel
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        state: absent
      register: error_delete_svi_interface_without_path_or_port_channel_or_virtual_port_channel
      ignore_errors: true

    - name: Create L3out svi interface of type port channel with invalid port channel template name
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port_channel
        port_channel:
          reference:
            name: '{{ port_channel_interface_1.current.name }}'
            template: invalid_template
      register: error_svi_interface_type_port_channel_invalid_template
      ignore_errors: true

    - name: Create L3out svi interface of type port channel with invalid port channel template id
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port_channel
        port_channel:
          reference:
            name: '{{ port_channel_interface_1.current.name }}'
            template_id: invalid_template_id
      register: error_svi_interface_type_port_channel_invalid_template_id
      ignore_errors: true

    - name: Create L3out svi interface of type port channel with invalid port channel name
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port_channel
        port_channel:
          reference:
            name: invalid_template_name
            template_id: '{{ port_channel_interface_1.current.templateId }}'
      register: error_svi_interface_type_port_channel_invalid_name
      ignore_errors: true

    - name: Create L3out svi interface of type port channel with invalid port channel uuid
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port_channel
        port_channel:
          uuid: invalid_template_uuid
      register: error_svi_interface_type_port_channel_invalid_template_uuid
      ignore_errors: true

    - name: Create L3out svi interface of type virtual port channel with invalid virtual port channel template name
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_virtual_port_channel
        virtual_port_channel:
          reference:
            name: '{{ virtual_port_channel_interface_1.current.name }}'
            template: invalid_template
      register: error_svi_interface_type_virtual_port_channel_invalid_template
      ignore_errors: true

    - name: Create L3out svi interface of type virtual port channel with invalid virtual port channel template id
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_virtual_port_channel
        virtual_port_channel:
          reference:
            name: '{{ virtual_port_channel_interface_1.current.name }}'
            template_id: invalid_template_id
      register: error_svi_interface_type_virtual_port_channel_invalid_template_id
      ignore_errors: true

    - name: Create L3out svi interface of type virtual port channel with invalid virtual port channel name
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_virtual_port_channel
        virtual_port_channel:
          reference:
            name: invalid_template_name
            template_id: '{{ virtual_port_channel_interface_1.current.templateId }}'
      register: error_svi_interface_type_virtual_port_channel_invalid_name
      ignore_errors: true

    - name: Create L3out svi interface of type virtual port channel with invalid virtual port channel uuid
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_virtual_port_channel
        virtual_port_channel:
          uuid: invalid_template_uuid
      register: error_svi_interface_type_virtual_port_channel_invalid_template_uuid
      ignore_errors: true

    - name: Create L3out svi interface of type port channel with path
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port_channel
        port_channel:
          uuid: '{{ port_channel_interface_1.current.uuid }}'
        path: eth1/1
      register: error_svi_interface_type_port_channel_with_path
      ignore_errors: true

    - name: Create L3out svi interface of type port channel with node_id
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port_channel
        port_channel:
          uuid: '{{ port_channel_interface_1.current.uuid }}'
        node_id: 101
      register: error_svi_interface_type_port_channel_with_node_id
      ignore_errors: true

    - name: Create L3out svi interface of type virtual port channel with path
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_virtual_port_channel
        virtual_port_channel:
          uuid: '{{ virtual_port_channel_interface_1.current.uuid }}'
        path: eth1/1
      register: error_svi_interface_type_virtual_port_channel_with_path
      ignore_errors: true

    - name: Create L3out svi interface of type virtual port channel with node_id
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_virtual_port_channel
        virtual_port_channel:
          uuid: '{{ virtual_port_channel_interface_1.current.uuid }}'
        node_id: 101
      register: error_svi_interface_type_virtual_port_channel_with_node_id
      ignore_errors: true

    - name: Create L3out svi interface of type virtual port channel with port channel
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_virtual_port_channel
        virtual_port_channel:
          uuid: '{{ virtual_port_channel_interface_1.current.uuid }}'
        port_channel:
          uuid: '{{ port_channel_interface_1.current.uuid }}'
      register: error_svi_interface_type_virtual_port_channel_with_port_channel
      ignore_errors: true

    - name: Create a L3out svi interface of type port without node_id
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        path: eth1/1
        encapsulation_type: vlan
        encapsulation_value: 100
        state: present
      ignore_errors: true
      register: error_svi_interface_type_port_without_node_id

    - name: Create a L3out svi interface of type port without encapsulation_type
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        node_id: 101
        path: eth1/1
        encapsulation_value: 100
        state: present
      ignore_errors: true
      register: error_svi_interface_type_port_without_encapsulation_type

    - name: Create a L3out svi interface of type port without encapsulation_value
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        node_id: 101
        path: eth1/1
        encapsulation_type: vlan
        state: present
      ignore_errors: true
      register: error_svi_interface_type_port_without_encapsulation_value

    - name: Create a L3out svi interface of type port channel without encapsulation_type
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        port_channel:
          uuid: '{{ port_channel_interface_1.current.uuid }}'
        encapsulation_value: 100
        state: present
      ignore_errors: true
      register: error_svi_interface_type_port_channel_without_encapsulation_type

    - name: Create a L3out svi interface of type port channel without encapsulation_value
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        port_channel:
          uuid: '{{ port_channel_interface_1.current.uuid }}'
        encapsulation_type: vlan
        state: present
      ignore_errors: true
      register: error_svi_interface_type_port_channel_without_encapsulation_value

    - name: Create a L3out svi interface of type virtual port channel without encapsulation_type
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        virtual_port_channel:
          uuid: '{{ port_channel_interface_1.current.uuid }}'
        encapsulation_value: 100
        state: present
      ignore_errors: true
      register: error_svi_interface_type_virtual_port_channel_without_encapsulation_type

    - name: Create a L3out svi interface of type virtual port channel without encapsulation_value
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        virtual_port_channel:
          uuid: '{{ port_channel_interface_1.current.uuid }}'
        encapsulation_type: vlan
        state: present
      ignore_errors: true
      register: error_svi_interface_type_virtual_port_channel_without_encapsulation_value

    - name: Assert that the error handling for svi interface creation works
      ansible.builtin.assert:
        that:
          - error_svi_interface_template_and_template_id is failed
          - error_svi_interface_template_and_template_id.msg == "parameters are mutually exclusive{{":"}} template|template_id"
          - error_svi_interface_l3out_and_l3out_uuid is failed
          - error_svi_interface_l3out_and_l3out_uuid.msg == "parameters are mutually exclusive{{":"}} l3out|l3out_uuid"
          - error_svi_interface_without_template_or_template_id is failed
          - error_svi_interface_without_template_or_template_id.msg == "one of the following is required{{":"}} template, template_id"
          - error_svi_interface_without_l3out_or_l3out_uuid is failed
          - error_svi_interface_without_l3out_or_l3out_uuid.msg == "one of the following is required{{":"}} l3out, l3out_uuid"
          - error_create_svi_interface_without_path_or_port_channel_or_virtual_port_channel is failed
          - error_create_svi_interface_without_path_or_port_channel_or_virtual_port_channel.msg == "state is present but any of the following are missing{{":"}} path, port_channel, virtual_port_channel"
          - error_delete_svi_interface_without_path_or_port_channel_or_virtual_port_channel is failed
          - error_delete_svi_interface_without_path_or_port_channel_or_virtual_port_channel.msg == "state is absent but any of the following are missing{{":"}} path, port_channel, virtual_port_channel"
          - error_svi_interface_type_port_channel_invalid_template is failed
          - error_svi_interface_type_port_channel_invalid_template.msg.startswith("Provided template name 'invalid_template' does not exist. Existing templates:")
          - error_svi_interface_type_port_channel_invalid_template_id is failed
          - error_svi_interface_type_port_channel_invalid_template_id.msg.startswith("Provided template id 'invalid_template_id' does not exist. Existing templates:")
          - error_svi_interface_type_port_channel_invalid_name is failed
          - error_svi_interface_type_port_channel_invalid_name.msg == "Provided Port Channel with '[KVPair(key='name', value='invalid_template_name')]' not matching existing object(s){{":"}} ansible_port_channel_interface_1, ansible_port_channel_interface_2"
          - error_svi_interface_type_port_channel_invalid_template_uuid is failed
          - error_svi_interface_type_port_channel_invalid_template_uuid.msg == "MSO Error 404{{":"}} policy not found"
          - error_svi_interface_type_virtual_port_channel_invalid_template is failed
          - error_svi_interface_type_virtual_port_channel_invalid_template.msg.startswith("Provided template name 'invalid_template' does not exist. Existing templates:")
          - error_svi_interface_type_virtual_port_channel_invalid_template_id is failed
          - error_svi_interface_type_virtual_port_channel_invalid_template_id.msg.startswith("Provided template id 'invalid_template_id' does not exist. Existing templates:")
          - error_svi_interface_type_virtual_port_channel_invalid_name is failed
          - error_svi_interface_type_virtual_port_channel_invalid_name.msg == "Provided Virtual Port Channel with '[KVPair(key='name', value='invalid_template_name')]' not matching existing object(s){{":"}} ansible_virtual_port_channel_interface_1, ansible_virtual_port_channel_interface_2"
          - error_svi_interface_type_virtual_port_channel_invalid_template_uuid is failed
          - error_svi_interface_type_virtual_port_channel_invalid_template_uuid.msg == "MSO Error 404{{":"}} policy not found"
          - error_svi_interface_type_port_channel_with_path is failed
          - error_svi_interface_type_port_channel_with_path.msg == "parameters are mutually exclusive{{":"}} port_channel|path"
          - error_svi_interface_type_port_channel_with_node_id is failed
          - error_svi_interface_type_port_channel_with_node_id.msg == "parameters are mutually exclusive{{":"}} port_channel|node_id"
          - error_svi_interface_type_virtual_port_channel_with_path is failed
          - error_svi_interface_type_virtual_port_channel_with_path.msg == "parameters are mutually exclusive{{":"}} virtual_port_channel|path"
          - error_svi_interface_type_virtual_port_channel_with_node_id is failed
          - error_svi_interface_type_virtual_port_channel_with_node_id.msg == "parameters are mutually exclusive{{":"}} virtual_port_channel|node_id"
          - error_svi_interface_type_virtual_port_channel_with_port_channel is failed
          - error_svi_interface_type_virtual_port_channel_with_port_channel.msg == "parameters are mutually exclusive{{":"}} port_channel|virtual_port_channel"
          - error_svi_interface_type_port_without_node_id is failed
          - error_svi_interface_type_port_without_node_id.msg == "missing parameter(s) required by 'path'{{":"}} node_id"
          - error_svi_interface_type_port_without_encapsulation_type is failed
          - error_svi_interface_type_port_without_encapsulation_type.msg == "missing parameter(s) required by 'path'{{":"}} encapsulation_type"
          - error_svi_interface_type_port_without_encapsulation_value is failed
          - error_svi_interface_type_port_without_encapsulation_value.msg == "missing parameter(s) required by 'path'{{":"}} encapsulation_value"
          - error_svi_interface_type_port_channel_without_encapsulation_type is failed
          - error_svi_interface_type_port_channel_without_encapsulation_type.msg == "missing parameter(s) required by 'port_channel'{{":"}} encapsulation_type"
          - error_svi_interface_type_port_channel_without_encapsulation_value is failed
          - error_svi_interface_type_port_channel_without_encapsulation_value.msg == "missing parameter(s) required by 'port_channel'{{":"}} encapsulation_value"
          - error_svi_interface_type_virtual_port_channel_without_encapsulation_type is failed
          - error_svi_interface_type_virtual_port_channel_without_encapsulation_type.msg == "missing parameter(s) required by 'virtual_port_channel'{{":"}} encapsulation_type"
          - error_svi_interface_type_virtual_port_channel_without_encapsulation_value is failed
          - error_svi_interface_type_virtual_port_channel_without_encapsulation_value.msg == "missing parameter(s) required by 'virtual_port_channel'{{":"}} encapsulation_value"

    # QUERY

    - name: Get a L3out svi interface of type port
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port
        state: query
      register: query_svi_interface_type_port

    - name: Get a L3out svi interface of type port channel
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_port_channel
        state: query
      register: query_svi_interface_type_port_channel

    - name: Get a L3out svi interface of type virtual port channel
      cisco.mso.ndo_l3out_svi_interface:
        <<: *create_svi_interface_type_virtual_port_channel
        state: query
      register: query_svi_interface_type_virtual_port_channel

    - name: Query all L3out svi interfaces
      cisco.mso.ndo_l3out_svi_interface:
        <<: *mso_info
        template: '{{ mso_l3out_template | default("ansible_test") }}'
        l3out: l3out_1
        state: query
      register: query_all_svi_interfaces

    - name: Assert that the L3out svi interfaces are queried
      ansible.builtin.assert:
        that:
          - query_svi_interface_type_port is not changed
          - query_svi_interface_type_port.current.path == "eth1/1"
          - query_svi_interface_type_port.current.podID == "1"
          - query_svi_interface_type_port.current.nodeID == "101"
          - query_svi_interface_type_port.current.pathType == "port"
          - query_svi_interface_type_port.current.pathRef is not defined
          - query_svi_interface_type_port_channel is not changed
          - query_svi_interface_type_port_channel.current.path is not defined
          - query_svi_interface_type_port_channel.current.podID is not defined
          - query_svi_interface_type_port_channel.current.nodeID is not defined
          - query_svi_interface_type_port_channel.current.pathRef is defined
          - query_svi_interface_type_port_channel.current.pathType == "pc"
          - query_svi_interface_type_port_channel.current.portChannelName == "ansible_port_channel_interface_1"
          - query_svi_interface_type_port_channel.current.portChannelTemplateId is defined
          - query_svi_interface_type_port_channel.current.portChannelTemplateName is defined
          - query_svi_interface_type_virtual_port_channel is not changed
          - query_svi_interface_type_virtual_port_channel.current.path is not defined
          - query_svi_interface_type_virtual_port_channel.current.podID is not defined
          - query_svi_interface_type_virtual_port_channel.current.nodeID is not defined
          - query_svi_interface_type_virtual_port_channel.current.pathRef is defined
          - query_svi_interface_type_virtual_port_channel.current.pathType == "vpc"
          - query_svi_interface_type_virtual_port_channel.current.virtualPortChannelName == "ansible_virtual_port_channel_interface_1"
          - query_svi_interface_type_virtual_port_channel.current.virtualPortChannelTemplateId is defined
          - query_svi_interface_type_virtual_port_channel.current.virtualPortChannelTemplateName is defined
          - query_all_svi_interfaces is not changed
          - query_all_svi_interfaces.current | length == 3

    # DELETE

    - name: Delete a L3out svi interface of type port (check mode)
      cisco.mso.ndo_l3out_svi_interface: &delete_svi_interface_type_port
        <<: *create_svi_interface_type_port
        state: absent
      check_mode: true
      register: cm_delete_svi_interface_type_port

    - name: Delete a L3out svi interface of type port
      cisco.mso.ndo_l3out_svi_interface:
        <<: *delete_svi_interface_type_port
      register: nm_delete_svi_interface_type_port 

    - name: Delete a L3out svi interface of type port again
      cisco.mso.ndo_l3out_svi_interface:
        <<: *delete_svi_interface_type_port
      register: nm_delete_svi_interface_type_port_again 

    - name: Assert that the L3out svi interface of type port was deleted
      ansible.builtin.assert:
        that:
          - cm_delete_svi_interface_type_port is changed
          - cm_delete_svi_interface_type_port.previous == query_svi_interface_type_port.current
          - cm_delete_svi_interface_type_port.proposed == cm_delete_svi_interface_type_port.current == {}
          - nm_delete_svi_interface_type_port is changed
          - nm_delete_svi_interface_type_port.previous == query_svi_interface_type_port.current
          - nm_delete_svi_interface_type_port.proposed == nm_delete_svi_interface_type_port.current == {}
          - nm_delete_svi_interface_type_port_again is not changed
          - nm_delete_svi_interface_type_port_again.previous == nm_delete_svi_interface_type_port_again.proposed == nm_delete_svi_interface_type_port_again.current == {}

    - name: Delete a L3out svi interface of type port channel (check mode)
      cisco.mso.ndo_l3out_svi_interface: &delete_svi_interface_type_port_channel
        <<: *create_svi_interface_type_port_channel
        state: absent
      check_mode: true
      register: cm_delete_svi_interface_type_port_channel

    - name: Delete a L3out svi interface of type port channel
      cisco.mso.ndo_l3out_svi_interface:
        <<: *delete_svi_interface_type_port_channel
      register: nm_delete_svi_interface_type_port_channel

    - name: Delete a L3out svi interface of type port channel again
      cisco.mso.ndo_l3out_svi_interface:
        <<: *delete_svi_interface_type_port_channel
      register: nm_delete_svi_interface_type_port_channel_again

    - name: Assert that the L3out svi interface of type port channel was deleted
      ansible.builtin.assert:
        that:
          - cm_delete_svi_interface_type_port_channel is changed
          - cm_delete_svi_interface_type_port_channel.previous == query_svi_interface_type_port_channel.current
          - cm_delete_svi_interface_type_port_channel.proposed == cm_delete_svi_interface_type_port_channel.current == {}
          - nm_delete_svi_interface_type_port_channel is changed
          - nm_delete_svi_interface_type_port_channel.previous == query_svi_interface_type_port_channel.current
          - nm_delete_svi_interface_type_port_channel.proposed == nm_delete_svi_interface_type_port_channel.current == {}
          - nm_delete_svi_interface_type_port_channel_again is not changed
          - nm_delete_svi_interface_type_port_channel_again.previous == nm_delete_svi_interface_type_port_channel_again.proposed == nm_delete_svi_interface_type_port_channel_again.current == {}

    - name: Delete a L3out svi interface of type virtual port channel (check mode)
      cisco.mso.ndo_l3out_svi_interface: &delete_svi_interface_type_virtual_port_channel
        <<: *create_svi_interface_type_virtual_port_channel
        state: absent
      check_mode: true
      register: cm_delete_svi_interface_type_virtual_port_channel

    - name: Delete a L3out svi interface of type virtual port channel
      cisco.mso.ndo_l3out_svi_interface:
        <<: *delete_svi_interface_type_virtual_port_channel
      register: nm_delete_svi_interface_type_virtual_port_channel

    - name: Delete a L3out svi interface of type virtual port channel again
      cisco.mso.ndo_l3out_svi_interface:
        <<: *delete_svi_interface_type_virtual_port_channel
      register: nm_delete_svi_interface_type_virtual_port_channel_again

    - name: Assert that the L3out svi interface of type virtual port channel was deleted
      ansible.builtin.assert:
        that:
          - cm_delete_svi_interface_type_virtual_port_channel is changed
          - cm_delete_svi_interface_type_virtual_port_channel.previous == query_svi_interface_type_virtual_port_channel.current
          - cm_delete_svi_interface_type_virtual_port_channel.proposed == cm_delete_svi_interface_type_virtual_port_channel.current == {}
          - nm_delete_svi_interface_type_virtual_port_channel is changed
          - nm_delete_svi_interface_type_virtual_port_channel.previous == query_svi_interface_type_virtual_port_channel.current
          - nm_delete_svi_interface_type_virtual_port_channel.proposed == nm_delete_svi_interface_type_virtual_port_channel.current == {}
          - nm_delete_svi_interface_type_virtual_port_channel_again is not changed
          - nm_delete_svi_interface_type_virtual_port_channel_again.previous == nm_delete_svi_interface_type_virtual_port_channel_again.proposed == nm_delete_svi_interface_type_virtual_port_channel_again.current == {}

    # CLEANUP TEMPLATE

    - name: Remove l3out template
      cisco.mso.ndo_template:
        <<: *ndo_l3out_template_absent

    - name: Remove ansible_test schema template
      cisco.mso.mso_schema_template:
        <<: *mso_schema_template_absent

    - name: Remove ansible_fabric_resource_template fabric_resource template
      cisco.mso.ndo_template:
        <<: *ndo_fabric_resource_template_absent

    - name: Remove ansible_fabric_policy_template fabric_policy template
      cisco.mso.ndo_template:
        <<: *ndo_fabric_policy_template_absent
